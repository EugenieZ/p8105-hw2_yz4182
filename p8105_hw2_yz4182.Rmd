---
tittle: "p8105 homework 2"
anthor: Yujin Zhang
output: github_document
---

This is a R MARKDOWN file.

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(readxl)
library(ggplot2)
```

## Problem 1 read and clean the Mr. Trash Wheel dataset.
```{r}
trashwheel_df = 
  read_excel("./hw_data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", range = "A2:N408") %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster)
trashwheel_df = transform(trashwheel_df, sports_balls = as.integer(sports_balls)) #no idea

precipitation_2018_df =
  read_excel("./hw_data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", sheet = "2018 Precipitation", range = "A2:B14") %>% 
  janitor::clean_names() %>%
  rename(total_precipitation = total) %>% 
  mutate(year = 2018) %>% 
  relocate(year)

precipitation_2019_df = 
  read_excel("./hw_data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", sheet = "2019 Precipitation", range = "A2:B14") %>% 
  janitor::clean_names() %>%
  drop_na(total) %>% 
  rename(total_precipitation = total) %>% 
  mutate(year = 2019) %>% 
  relocate(year)

precipitation_df = 
  bind_rows(precipitation_2018_df, precipitation_2019_df) %>% 
  mutate(month = month.name[month]) # no idea what else solution to combine the df
```

```{r, echo=FALSE}
sportsballs_2017_df = filter(trashwheel_df, year == 2017)
```

The number of observation in trash wheel dataset is `r nrow(trashwheel_df)`, and the number of observation in precipitation dataset is `r nrow(precipitation_2018_df) + nrow(precipitation_2019_df)`. The key variables?
The total precipitation in 2018 is `r sum(pull(precipitation_2018_df, total_precipitation))`. The median number of sports balls in a dumpster in 2017 is `r median(pull(sportsballs_2017_df, sports_balls))`.



## Problem 2
```{r}
pols_month_df = 
  read_csv("./hw_data/pols-month.csv") %>% 
  janitor::clean_names() %>%
  separate(mon, into = c("year", "month", "day")) %>% 
  transform(year = as.integer(year), month = as.integer(month), day = as.integer(day)) %>% 
  mutate(month = month.name[month]) %>% 
  mutate(president = prez_dem) %>% 
  mutate(
    president = recode(president, "0" = "gop", "1" = "dem")) 
pols_month_df = select(pols_month_df, -day, -prez_dem, -prez_gop)

```


## Clean the data in snp.csv
```{r}
snp_df =
  read_csv("./hw_data/snp.csv") %>%
  janitor::clean_names() %>%
  mutate(date = parse_datetime(date, "%m/%d/%y")) %>% # how to figure out two CE with number 0-68
  mutate(date = as.Date(ifelse(date > Sys.Date(), format(date, "19%y-%m-%d"), format(date)))) %>% 
  separate(date, into = c("year", "month", "day")) %>% 
  mutate(year = as.integer(year), month = as.integer(month), day = as.integer(day)) %>% 
  # mutate(year(year(vals) > 2021) = year(vals) - 100) %>% 
  arrange(year, month) %>% 
  mutate(month = month.name[month]) 
snp_df = select(snp_df, -day) %>% 
  relocate(year)

```

## Tide the unemployment data.
```{r}
unemployment_df = 
  read_csv("./hw_data/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  rename(
    January = jan,
    Febrary = feb,
    March = mar,
    April = apr,
    May = may,
    June = jun,
    July = jul,
    Augest = aug,
    September = sep,
    October = oct,
    November = nov,
    December = dec
  ) %>% 
  pivot_longer(
    January:December,
    names_to = "month",
    values_to = "percentage of unemployment"
  ) 
```

## Join the three dataset above.
```{r}
join_two_df = left_join(pols_month_df, snp_df, by = c("year" = "year", "month" = "month")) # how to do this with two same column? 
join_df = left_join(join_two_df, unemployment_df, by = c("year" = "year", "month" = "month"))
```
The dataset of "pols_month_df" contains 9 variables:`r names(pols_month_df)` and 822 observations with a range from 1947-2015.
The dataset of "snp_df" contains 3 variables:`r names(snp_df)` and 787 observations with a range from 1950-2015.
The dataset of "unemployment_df" contains 3 variables:`r names(unemployment_df)` and 816 observations with a range from 1948-2015.
The resulting dataset "join_df" contains variables `r names(join_df)` and 822 observations from 1947-2015.


## Problem 3
```{r}
popl_babynames_df =
  read_csv("./hw_data/Popular_Baby_Names.csv") %>% 
  janitor::clean_names() %>%
  mutate(childs_first_name = toupper(childs_first_name)) %>%
  mutate(ethnicity = tolower(ethnicity)) %>% 
  distinct(year_of_birth, gender, ethnicity, childs_first_name, .keep_all = TRUE)

olivia_popl_df =
  filter(popl_babynames_df, 
         gender == "FEMALE",
         childs_first_name == "OLIVIA"
         ) %>% 
  arrange(year_of_birth)

male_popl_df =
  filter(popl_babynames_df,
         gender == "MALE",
         rank == 1
         ) %>% 
  arrange(year_of_birth)
```

```{r}
malename_2016_df = 
  filter(popl_babynames_df,
         year_of_birth == 2016,
         gender == "MALE",
         ethnicity == "white non hispanic",
         )
ggplot(malename_2016_df, aes(x = rank, y = count)) + geom_point()
```
